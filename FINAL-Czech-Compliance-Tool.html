<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Czech Cybersecurity Compliance Tool - FINAL WORKING VERSION</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- jsPDF Library for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --threat-critical: #dc3545;
            --threat-high: #fd7e14;
            --threat-medium: #ffc107;
            --threat-low: #17a2b8;
            --threat-info: #6c757d;
            --success-green: #28a745;
            --primary-blue: #0066cc;
            --secondary-purple: #6f42c1;
            --czech-blue: #0033a0;
            --eu-gold: #ffd700;
            --dark-bg: #0d1117;
            --card-bg: rgba(13, 17, 23, 0.95);
            --card-border: rgba(255, 255, 255, 0.15);
            --text-primary: #ffffff;
            --text-secondary: #e9ecef;
            --text-muted: #adb5bd;
            --text-shadow: 0 2px 4px rgba(0,0,0,0.7);
            --glow-blue: rgba(0,102,204,0.4);
        }

        body {
            background: linear-gradient(135deg, #0d1117 0%, #161b22 25%, #0f1419 50%, #1a1f2e 75%, #16213e 100%);
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .czech-header {
            background: linear-gradient(135deg, var(--czech-blue) 0%, #0066cc 100%);
            color: white;
            padding: 3rem 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,51,160,0.3);
            position: relative;
            z-index: 10;
        }

        .czech-header h1 {
            font-size: 3rem;
            font-weight: 900;
            text-shadow: var(--text-shadow);
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .compliance-flags {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .compliance-flag {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .flag-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .flag-name { font-size: 0.9rem; font-weight: 700; color: var(--text-primary); }

        .main-nav {
            background: var(--dark-bg);
            padding: 0;
            z-index: 100;
            border-bottom: 3px solid var(--card-border);
            position: sticky;
            top: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            border: none;
            padding: 0 2rem;
            justify-content: center;
        }

        .nav-tabs .nav-link {
            color: var(--text-secondary);
            border: none;
            border-radius: 8px 8px 0 0;
            padding: 1rem 1.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            margin-right: 0.25rem;
            background: rgba(255,255,255,0.05);
        }

        .nav-tabs .nav-link:hover { color: var(--text-primary); background: rgba(0,102,204,0.1); }
        .nav-tabs .nav-link.active { background: linear-gradient(135deg, var(--primary-blue), rgba(0, 102, 204, 0.8)); color: white; }

        .main-content { padding: 3rem 2rem; min-height: calc(100vh - 350px); }

        .compliance-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 20px;
            margin-bottom: 2rem;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        .compliance-card:hover { border-color: var(--primary-blue); transform: translateY(-8px); }

        .card-header-custom {
            background: linear-gradient(135deg, var(--dark-bg), rgba(22, 27, 34, 0.9));
            padding: 2.5rem 3rem;
            border-bottom: 3px solid var(--card-border);
        }

        .card-header-custom h3 {
            color: var(--text-primary);
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 1rem;
            text-shadow: var(--text-shadow);
        }

        .card-header-custom h3 i { color: var(--primary-blue); font-size: 2.2rem; }

        .card-body-custom { padding: 3rem; }

        .form-control {
            background-color: rgba(33, 37, 41, 0.8);
            color: var(--text-primary);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .form-control:focus { background-color: rgba(33, 37, 41, 0.9); color: var(--text-primary); border-color: var(--primary-blue); }

        .btn {
            border-radius: 12px;
            font-weight: 700;
            padding: 0.75rem 2rem;
            transition: all 0.3s ease;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), rgba(0, 102, 204, 0.9));
            box-shadow: 0 4px 15px rgba(0,102,204,0.4);
        }

        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,102,204,0.6); }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #20c997);
            box-shadow: 0 4px 15px rgba(40,167,69,0.4);
        }

        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
        .checkbox-item { background: rgba(255,255,255,0.05); border: 2px solid var(--card-border); border-radius: 12px; padding: 1rem; transition: all 0.3s ease; }
        .compliance-result { background: var(--card-bg); border: 2px solid var(--card-border); border-radius: 16px; padding: 2rem; margin-top: 2rem; display: none; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; margin: 0 auto 1rem; box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
        .score-high { background: linear-gradient(135deg, var(--success-green), #20c997); color: white; }
        .score-medium { background: linear-gradient(135deg, var(--threat-medium), #ffb84d); color: black; }
        .score-low { background: linear-gradient(135deg, var(--threat-critical), #b02a37); color: white; }
        .progress { height: 1.5rem; border-radius: 10px; background: var(--dark-bg); border: 2px solid var(--card-border); }
        .progress-bar { border-radius: 8px; font-weight: 700; font-size: 0.9rem; transition: width 1s ease; }
        .risk-matrix { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(5, 1fr); gap: 2px; margin: 2rem auto; max-width: 400px; aspect-ratio: 1; }
        .risk-cell { display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; color: white; cursor: pointer; transition: all 0.3s ease; border-radius: 4px; }
        .risk-low { background: rgba(23,162,184,0.8); }
        .risk-medium { background: rgba(255,193,7,0.8); }
        .risk-high { background: rgba(253,126,20,0.8); }
        .risk-critical { background: rgba(220,53,69,0.8); }
        .risk-cell:hover { transform: scale(1.1); }
        .download-section { background: linear-gradient(135deg, var(--success-green), #20c997); border-radius: 16px; padding: 3rem; text-align: center; margin-top: 3rem; color: white; }
        .document-types { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0; }
        .document-type { background: rgba(255,255,255,0.15); border-radius: 12px; padding: 1.5rem; border: 2px solid rgba(255,255,255,0.2); transition: all 0.3s ease; }
        .document-type:hover { transform: translateY(-4px); border-color: rgba(255,255,255,0.4); }
        .document-type i { font-size: 2rem; margin-bottom: 0.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .tab-content { opacity: 0; animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="czech-header">
        <div class="container">
            <h1><i class="fas fa-shield-alt me-3"></i>Czech Cybersecurity Compliance Tool</h1>
            <p>Komplexní nástroj pro identifikaci rizik a tvorbu dokumentace v souladu s českým právem</p>
            <div class="compliance-flags">
                <div class="compliance-flag"><div class="flag-icon" style="color: var(--czech-blue);"><i class="fas fa-european-union"></i></div><div class="flag-name">NIS2 směrnice</div></div>
                <div class="compliance-flag"><div class="flag-icon" style="color: var(--eu-gold);"><i class="fas fa-coins"></i></div><div class="flag-name">DORA směrnice</div></div>
                <div class="compliance-flag"><div class="flag-icon" style="color: var(--primary-blue);"><i class="fas fa-lock"></i></div><div class="flag-name">GDPR nařízení</div></div>
                <div class="compliance-flag"><div class="flag-icon" style="color: var(--threat-critical);"><i class="fas fa-gavel"></i></div><div class="flag-name">Zákon o kyber. bezpečnosti</div></div>
            </div>
        </div>
    </div>

    <nav class="main-nav">
        <div class="container">
            <ul class="nav nav-tabs" id="complianceTabs" role="tablist">
                <li class="nav-item"><button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button"><i class="fas fa-home me-2"></i>Přehled</button></li>
                <li class="nav-item"><button class="nav-link" id="risk-tab" data-bs-toggle="tab" data-bs-target="#risk" type="button"><i class="fas fa-exclamation-triangle me-2"></i>Identifikace rizik</button></li>
                <li class="nav-item"><button class="nav-link" id="assessment-tab" data-bs-toggle="tab" data-bs-target="#assessment" type="button"><i class="fas fa-clipboard-check me-2"></i>Hodnocení dopadu</button></li>
                <li class="nav-item"><button class="nav-link" id="compliance-tab" data-bs-toggle="tab" data-bs-target="#compliance" type="button"><i class="fas fa-balance-scale me-2"></i>Kontrola compliance</button></li>
                <li class="nav-item"><button class="nav-link" id="documentation-tab" data-bs-toggle="tab" data-bs-target="#documentation" type="button"><i class="fas fa-file-alt me-2"></i>Dokumentace</button></li>
            </ul>
        </div>
    </nav>

    <div class="main-content">
        <div class="container">
            <div class="tab-content" id="complianceTabContent">
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                    <div class="compliance-card">
                        <div class="card-header-custom"><h3><i class="fas fa-info-circle"></i>Vítejte v nástroju pro compliance</h3></div>
                        <div class="card-body-custom">
                            <div class="alert alert-success mt-4"><strong>✅ KONEČNÁ VERZE S FUNGUJÍCÍM PDF EXPORTEM!</strong></div>
                            <div class="row">
                                <div class="col-lg-6">
                                    <h5 class="text-white mb-3"><i class="fas fa-star me-2" style="color: var(--success-green);"></i>Komplexní pokrytí</h5>
                                    <ul class="text-muted">
                                        <li>✅ Zákon o kybernetické bezpečnosti (č. 181/2023 Sb.)</li>
                                        <li>✅ Směrnice NIS2 (EU/2022/2555)</li>
                                        <li>✅ Nařízení DORA (EU/2022/2554)</li>
                                        <li>✅ GDPR (EU/2016/679) a související předpisy</li>
                                    </ul>
                                </div>
                                <div class="col-lg-6">
                                    <h5 class="text-white mb-3"><i class="fas fa-tools me-2" style="color: var(--primary-blue);"></i>Pokročilé funkce</h5>
                                    <ul class="text-muted">
                                        <li>🔍 Automatická identifikace rizik</li>
                                        <li>📊 Hodnocení dopadu a pravděpodobnosti</li>
                                        <li>📋 Kontrola souladu s předpisy</li>
                                        <li>📄 <strong>Fungující PDF export</strong></li>
                                        <li>💾 Automatické ukládání dokumentů</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other tabs here -->
                <div class="tab-pane fade" id="risk" role="tabpanel">
                    <div class="compliance-card">
                        <div class="card-header-custom"><h3><i class="fas fa-search-plus"></i>Identifikace a hodnocení rizik</h3></div>
                        <div class="card-body-custom">
                            <div class="row">
                                <div class="col-lg-7">
                                    <h5 class="text-white mb-4">Hodnotící kritéria</h5>
                                    <div class="mb-4">
                                        <label class="form-label"><i class="fas fa-building"></i>Sektor činnosti organizace</label>
                                        <select class="form-select" id="organizationSector">
                                            <option value="">Vyberte sektor...</option>
                                            <option value="finance">Finanční instituce (banky, pojišťovny)</option>
                                            <option value="energy">Energetika a kritická infrastruktura</option>
                                            <option value="healthcare">Zdravotnictví</option>
                                            <option value="transport">Doprava a logistika</option>
                                            <option value="digital">Digitální služby a e-commerce</option>
                                            <option value="government">Veřejná správa</option>
                                            <option value="manufacturing">Výroba a průmysl</option>
                                            <option value="other">Ostatní služby</option>
                                        </select>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label"><i class="fas fa-users"></i>Velikost organizace</label>
                                        <select class="form-select" id="organizationSize">
                                            <option value="">Vyberte velikost...</option>
                                            <option value="large">Velká organizace (500+ zaměstnanců)</option>
                                            <option value="medium">Střední organizace (50-499 zaměstnanců)</option>
                                            <option value="small">Malá organizace (< 50 zaměstnanců)</option>
                                            <option value="micro">Mikro organizace (< 10 zaměstnanců)</option>
                                        </select>
                                    </div>
                                    <div class="checkbox-grid">
                                        <div class="checkbox-item"><input type="checkbox" id="personalData"><label for="personalData">Osobní údaje zaměstnanců</label></div>
                                        <div class="checkbox-item"><input type="checkbox" id="customerData"><label for="customerData">Údaje zákazníků/klientů</label></div>
                                        <div class="checkbox-item"><input type="checkbox" id="financialData"><label for="financialData">Finanční údaje</label></div>
                                        <div class="checkbox-item"><input type="checkbox" id="healthData"><label for="healthData">Zdravotní údaje</label></div>
                                    </div>
                                    <button class="btn btn-primary w-100" onclick="identifyRisks()">🔍 Identifikovat rizika</button>
                                </div>
                                <div class="col-lg-5">
                                    <h5 class="text-white mb-4">Identifikované rizika</h5>
                                    <div id="riskIdentificationResults"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="assessment" role="tabpanel">
                    <div class="compliance-card">
                        <div class="card-header-custom"><h3><i class="fas fa-balance-scale"></i>Hodnocení dopadu a pravděpodobnosti</h3></div>
                        <div class="card-body-custom">
                            <div class="row">
                                <div class="col-lg-6"><h5 class="text-white mb-4">Riziková matice</h5><div class="risk-matrix" id="riskMatrix"></div></div>
                                <div class="col-lg-6"><h5 class="text-white mb-4">Aktuální ohodnocení</h5><div id="assessmentResults"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="compliance" role="tabpanel">
                    <div class="compliance-card">
                        <div class="card-header-custom"><h3><i class="fas fa-european-union"></i>Kontrola compliance - NIS2</h3></div>
                        <div class="card-body-custom">
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="nis2-baseline"><label for="nis2-baseline">Základní bezpečnostní opatření</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nis2-reporting"><label for="nis2-reporting">Systém hlášení incidentů</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nis2-training"><label for="nis2-training">Školení zaměstnanců</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nis2-audit"><label for="nis2-audit">Audit bezpečnosti</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nis2-supply-chain"><label for="nis2-supply-chain">Řízení dodavatelského řetězce</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="nis2-crypto"><label for="nis2-crypto">Kryptografická opatření</label></div>
                            </div>
                            <button class="btn btn-primary w-100 mt-4" onclick="checkNIS2Compliance()">Kontrolovat NIS2 compliance</button>
                            <div class="compliance-result" id="nis2Results"></div>
                        </div>
                    </div>

                    <div class="compliance-card">
                        <div class="card-header-custom"><h3><i class="fas fa-coins"></i>Kontrola compliance - DORA</h3></div>
                        <div class="card-body-custom">
                            <div class="checkbox-grid">
                                <div class="checkbox-item"><input type="checkbox" id="dora-ict-risk"><label for="dora-ict-risk">Řízení ICT rizik</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dora-reporting"><label for="dora-reporting">ICT incident reporting</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dora-protection"><label for="dora-protection">Ochrana digitálních opatření</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dora-testing"><label for="dora-testing">Testování odolnosti</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dora-third-party"><label for="dora-third-party">Řízení dodavatelů ICT</label></div>
                                <div class="checkbox-item"><input type="checkbox" id="dora-continuity"><label for="dora-continuity">Kontinuita služeb</label></div>
                            </div>
                            <button class="btn btn-primary w-100 mt-4" onclick="checkDORACompliance()">Kontrolovat DORA compliance</button>
                            <div class="compliance-result" id="doraResults"></div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="documentation" role="tabpanel">
                    <div class="download-section">
                        <h3 class="text-white mb-1"><i class="fas fa-file-pdf me-3"></i>Fungující PDF export</h3>
                        <p class="text-white-50">Všechny dokumenty jsou automoticky vygenerované a připravené ke stažení</p>

                        <div class="document-types">
                            <div class="document-type" onclick="generateRiskAssessmentPDF()">
                                <i class="fas fa-exclamation-triangle text-white"></i>
                                <h6 class="text-white mt-3">Hodnocení rizik</h6>
                                <p class="text-white-75 small">Komplexní analýza identifikovaných rizik</p>
                            </div>
                            <div class="document-type" onclick="generateSafetyMeasuresPDF()">
                                <i class="fas fa-shield-alt text-white"></i>
                                <h6 class="text-white mt-3">Bezpečnostní opatření</h6>
                                <p class="text-white-75 small">Doporučené bezpečnostní opatření</p>
                            </div>
                            <div class="document-type" onclick="generateIncidentReportPDF()">
                                <i class="fas fa-bullhorn text-white"></i>
                                <h6 class="text-white mt-3">Incident report</h6>
                                <p class="text-white-75 small">Sestava pro hlášení incidentů</p>
                            </div>
                            <div class="document-type" onclick="generateNIS2ComplianceReportPDF()">
                                <i class="fas fa-european-union text-white"></i>
                                <h6 class="text-white mt-3">NIS2 compliance</h6>
                                <p class="text-white-75 small">Zpráva o souladu s NIS2</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Initialize risk matrix on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeRiskMatrix();
            initializeTabs();
        });

        // Tab switching functionality
        function initializeTabs() {
            const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                });
            });
        }

        // Risk identification function
        function identifyRisks() {
            const sector = document.getElementById('organizationSector').value;
            const size = document.getElementById('organizationSize').value;
            const personalData = document.getElementById('personalData').checked;
            const customerData = document.getElementById('customerData').checked;
            const financialData = document.getElementById('financialData').checked;
            const healthData = document.getElementById('healthData').checked;

            let risks = [];
            let riskLevel = 'low';

            // Basic risk identification logic
            if (sector === 'energy' || sector === 'healthcare') {
                risks.push('Kritická infrastruktura - vysoké riziko');
                riskLevel = 'critical';
            } else if (sector === 'finance') {
                risks.push('Finanční data - vysoké riziko úniku');
                riskLevel = 'high';
            }

            if (size === 'large' || size === 'medium') {
                risks.push('Velká organizace - vyšší komplexita řízení');
                if (riskLevel === 'low') riskLevel = 'medium';
            }

            if (personalData) risks.push('Osobní údaje zaměstnanců - GDPR compliance');
            if (customerData) risks.push('Údaje zákazníků - regulatorní požadavky');
            if (financialData) risks.push('Finanční údaje - vysoké riziko');
            if (healthData) {
                risks.push('Zdravotní údaje - maximální ochrana');
                riskLevel = 'critical';
            }

            // Display results
            const resultsDiv = document.getElementById('riskIdentificationResults');
            resultsDiv.innerHTML = `
                <div class="alert alert-${riskLevel === 'critical' ? 'danger' : riskLevel === 'high' ? 'warning' : 'info'}">
                    <h6><i class="fas fa-exclamation-triangle"></i> Identifikované rizika:</h6>
                    <ul>
                        ${risks.map(risk => `<li>${risk}</li>`).join('')}
                    </ul>
                    <strong>Celkové hodnocení rizika: ${riskLevel.toUpperCase()}</strong>
                </div>
            `;

            // Add animation
            resultsDiv.style.animation = 'fadeIn 0.5s ease';
        }

        // NIS2 compliance checking function
        function checkNIS2Compliance() {
            const checkboxes = [
                'nis2-baseline', 'nis2-reporting', 'nis2-training',
                'nis2-audit', 'nis2-supply-chain', 'nis2-crypto'
            ];

            let checkedCount = 0;
            checkboxes.forEach(id => {
                if (document.getElementById(id).checked) checkedCount++;
            });

            const compliancePercentage = Math.round((checkedCount / checkboxes.length) * 100);

            let status, color, recommendations = [];
            if (compliancePercentage >= 83) { // 5/6
                status = 'Vysoký soulad';
                color = 'high';
                recommendations = ['Pravidelný audit', 'Aktualizace školení'];
            } else if (compliancePercentage >= 67) { // 4/6
                status = 'Střední soulad';
                color = 'medium';
                recommendations = ['Doplnit chybějící opatření', 'Provést školení zaměstnanců'];
            } else {
                status = 'Nízký soulad';
                color = 'low';
                recommendations = ['Implementovat základní bezpečnostní opatření', 'Připravit systém hlášení incidentů', 'Zavést školení'];
            }

            const resultsDiv = document.getElementById('nis2Results');
            resultsDiv.innerHTML = `
                <div class="text-center">
                    <div class="score-circle score-${color}">${compliancePercentage}%</div>
                    <h5 class="text-white mt-3">${status}</h5>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-${color === 'high' ? 'success' : color === 'medium' ? 'warning' : 'danger'}"
                             style="width: ${compliancePercentage}%">${compliancePercentage}%</div>
                    </div>
                    <h6 class="text-white">Doporučení pro zlepšení:</h6>
                    <ul class="text-left">
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;

            resultsDiv.style.display = 'block';
        }

        // DORA compliance checking function
        function checkDORACompliance() {
            const checkboxes = [
                'dora-ict-risk', 'dora-reporting', 'dora-protection',
                'dora-testing', 'dora-third-party', 'dora-continuity'
            ];

            let checkedCount = 0;
            checkboxes.forEach(id => {
                if (document.getElementById(id).checked) checkedCount++;
            });

            const compliancePercentage = Math.round((checkedCount / checkboxes.length) * 100);

            let status, color, recommendations = [];
            if (compliancePercentage >= 83) {
                status = 'Vysoký soulad s DORA';
                color = 'high';
                recommendations = ['Pravidelné testování', 'Monitoring dodavatelů'];
            } else if (compliancePercentage >= 67) {
                status = 'Střední soulad s DORA';
                color = 'medium';
                recommendations = ['Zlepšit řízení ICT rizik', 'Implementovat testování'];
            } else {
                status = 'Nízký soulad s DORA';
                color = 'low';
                recommendations = ['Zavést řízení ICT rizik', 'Implementovat reporting', 'Nastavit kontinuitu služeb'];
            }

            const resultsDiv = document.getElementById('doraResults');
            resultsDiv.innerHTML = `
                <div class="text-center">
                    <div class="score-circle score-${color}">${compliancePercentage}%</div>
                    <h5 class="text-white mt-3">${status}</h5>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-${color === 'high' ? 'success' : color === 'medium' ? 'warning' : 'danger'}"
                             style="width: ${compliancePercentage}%">${compliancePercentage}%</div>
                    </div>
                    <h6 class="text-white">Doporučení pro soulad s DORA:</h6>
                    <ul class="text-left">
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;

            resultsDiv.style.display = 'block';
        }

        // Initialize risk matrix
        function initializeRiskMatrix() {
            const riskMatrix = document.getElementById('riskMatrix');
            if (!riskMatrix) return;

            const riskLevels = [
                ['Nízké riziko', 'Nízké riziko', 'Střední riziko', 'Vysoké riziko', 'Kritické riziko'],
                ['Nízké riziko', 'Střední riziko', 'Vysoké riziko', 'Kritické riziko', 'Kritické riziko'],
                ['Střední riziko', 'Vysoké riziko', 'Kritické riziko', 'Kritické riziko', 'Kritické riziko'],
                ['Vysoké riziko', 'Kritické riziko', 'Kritické riziko', 'Kritické riziko', 'Kritické riziko'],
                ['Kritické riziko', 'Kritické riziko', 'Kritické riziko', 'Kritické riziko', 'Kritické riziko']
            ];

            let html = '';
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    const riskClass = riskLevels[row][col].includes('Kritické') ? 'risk-critical' :
                                    riskLevels[row][col].includes('Vysoké') ? 'risk-high' :
                                    riskLevels[row][col].includes('Střední') ? 'risk-medium' : 'risk-low';

                    html += `<div class="risk-cell ${riskClass}" onclick="selectRiskCell(this, ${row}, ${col})">${riskLevels[row][col]}</div>`;
                }
            }
            riskMatrix.innerHTML = html;
        }

        // Function to handle risk matrix cell selection
        function selectRiskCell(cell, row, col) {
            // Remove selection from all cells
            document.querySelectorAll('.risk-cell').forEach(c => c.classList.remove('selected'));
            // Add selection to clicked cell
            cell.classList.add('selected');

            const riskLevels = {
                'Nízké riziko': 'low',
                'Střední riziko': 'medium',
                'Vysoké riziko': 'high',
                'Kritické riziko': 'critical'
            };

            const riskValue = cell.textContent;
            const riskLevel = riskLevels[riskValue] || 'unknown';

            const assessmentDiv = document.getElementById('assessmentResults');
            assessmentDiv.innerHTML = `
                <div class="alert alert-${riskLevel === 'critical' ? 'danger' : riskLevel === 'high' ? 'warning' : riskLevel === 'medium' ? 'info' : 'success'}">
                    <h6><i class="fas fa-chart-line"></i> Vyhodnocení rizika:</h6>
                    <p>Pravděpodobnost: ${5-row}/5, Dopad: ${col+1}/5</p>
                    <p><strong>Celkové riziko: ${riskValue.toUpperCase()}</strong></p>
                    <p>Doporučení: ${getRiskRecommendation(riskValue)}</p>
                </div>
            `;
        }

        // Get risk recommendation based on risk level
        function getRiskRecommendation(riskValue) {
            const recommendations = {
                'Nízké riziko': 'Monitorování rizika, žádná okamžitá opatření nutná',
                'Střední riziko': 'Zvážení preventivních opatření, pravidelný monitoring',
                'Vysoké riziko': 'Implementace bezpečnostních opatření, prioritní řešení',
                'Kritické riziko': 'Okamžité řešení nutné, zapojení vedení organizace'
            };
            return recommendations[riskValue] || 'Provést detailní analýzu';
        }

        // PDF Generation Functions
        function generateRiskAssessmentPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Add title
                doc.setFontSize(20);
                doc.text('Czech Cybersecurity Compliance Tool', 105, 30, { align: 'center' });
                doc.setFontSize(16);
                doc.text('Analýza rizik organizace', 105, 50, { align: 'center' });

                // Get current data
                const sector = document.getElementById('organizationSector').selectedOptions[0]?.text || 'Neuvedeno';
                const size = document.getElementById('organizationSize').selectedOptions[0]?.text || 'Neuvedeno';

                doc.setFontSize(12);
                doc.text(`Sektor: ${sector}`, 20, 80);
                doc.text(`Velikost organizace: ${size}`, 20, 90);

                // Get risk results
                const riskData = document.getElementById('riskIdentificationResults').innerText || 'Žádná data';

                doc.text('Identifikované rizika:', 20, 110);
                const lines = doc.splitTextToSize(riskData, 170);
                doc.text(lines, 20, 120);

                // Footer
                doc.setFontSize(8);
                doc.text(`Vygenerováno: ${new Date().toLocaleString('cs-CZ')}`, 20, 280);

                doc.save('risk_assessment_czech.pdf');
                alert('✅ PDF dokument byl úspěšně vygenerován a stažen!');
            } catch (error) {
                console.error('PDF Error:', error);
                alert('❌ Chyba při generování PDF: ' + error.message);
            }
        }

        function generateSafetyMeasuresPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(20);
                doc.text('Bezpečnostní opatření', 105, 30, { align: 'center' });
                doc.setFontSize(16);
                doc.text('Doporučená implementace', 105, 50, { align: 'center' });

                doc.setFontSize(12);
                doc.text('1. Základní bezpečnostní opatření:', 20, 80);
                doc.text('   - Firewall a IDS/IPS systémy', 30, 90);
                doc.text('   - Antivirová ochrana', 30, 100);
                doc.text('   - Aktualizace systémů', 30, 110);

                doc.text('2. Řízení přístupu:', 20, 130);
                doc.text('   - Princip nejmenších oprávnění', 30, 140);
                doc.text('   - Dvoufaktorová autentizace', 30, 150);
                doc.text('   - Správa hesel', 30, 160);

                doc.text('3. Školení a povědomí:', 20, 180);
                doc.text('   - Bezpečnostní školení zaměstnanců', 30, 190);
                doc.text('   - Simulace phishing útoků', 30, 200);
                doc.text('   - Pravidelná školení', 30, 210);

                // Footer
                doc.setFontSize(8);
                doc.text(`Vygenerováno: ${new Date().toLocaleString('cs-CZ')}`, 20, 280);

                doc.save('safety_measures_czech.pdf');
                alert('✅ PDF dokument byl úspěšně vygenerován a stažen!');
            } catch (error) {
                console.error('PDF Error:', error);
                alert('❌ Chyba při generování PDF: ' + error.message);
            }
        }

        function generateIncidentReportPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(20);
                doc.text('Hlášení kybernetického incidentu', 105, 30, { align: 'center' });
                doc.setFontSize(16);
                doc.text('Podle NIS2 směrnice', 105, 50, { align: 'center' });

                doc.setFontSize(12);
                doc.text('Sekce 1: Identifikace incidentu', 20, 80);
                doc.text('Název incidentu:', 30, 90);
                doc.text('Datum a čas:', 30, 100);
                doc.text('Popis incidentu:', 30, 110);

                doc.text('Sekce 2: Dopad incidentu', 20, 130);
                doc.text('Finanční dopad:', 30, 140);
                doc.text('Provozní dopad:', 30, 150);
                doc.text('Bezpečnostní dopad:', 30, 160);

                doc.text('Sekce 3: Reakce a nápravné opatření', 20, 180);
                doc.text('Přijaté opatření:', 30, 190);
                doc.text('Opatření k prevenci:', 30, 200);
                doc.text('Naučení lekce:', 30, 210);

                // Footer
                doc.setFontSize(8);
                doc.text(`Vygenerováno: ${new Date().toLocaleString('cs-CZ')}`, 20, 280);
                doc.text('Šablona podle NIS2 směrnice (EU/2022/2555)', 20, 285);

                doc.save('incident_report_czech.pdf');
                alert('✅ PDF dokument incident report byl vygenerován a stažen!');
            } catch (error) {
                console.error('PDF Error:', error);
                alert('❌ Chyba při generování PDF: ' + error.message);
            }
        }

        function generateNIS2ComplianceReportPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(20);
                doc.text('NIS2 Compliance Report', 105, 30, { align: 'center' });
                doc.setFontSize(16);
                doc.text('Zpráva o souladu s NIS2', 105, 50, { align: 'center' });

                doc.setFontSize(14);
                doc.text('Shrnutí hodnocení:', 20, 80);

                // Get compliance data from current page state
                const nis2Checkboxes = [
                    'nis2-baseline', 'nis2-reporting', 'nis2-training',
                    'nis2-audit', 'nis2-supply-chain', 'nis2-crypto'
                ];

                let checkedCount = 0;
                nis2Checkboxes.forEach(id => {
                    if (document.getElementById(id) && document.getElementById(id).checked) {
                        checkedCount++;
                    }
                });

                const compliance = Math.round((checkedCount / nis2Checkboxes.length) * 100);

                doc.setFontSize(12);
                doc.text(`Procento souladu: ${compliance}%`, 30, 100);
                doc.text(`Implementovaných opatření: ${checkedCount}/${nis2Checkboxes.length}`, 30, 115);

                doc.text('Požadavky NIS2:', 20, 135);
                const requirements = [
                    '✓ Základní bezpečnostní opatření',
                    '✓ Systém hlášení incidentů',
                    '✓ Školení zaměstnanců',
                    '✓ Audit bezpečnosti',
                    '✓ Řízení dodavatelského řetězce',
                    '✓ Kryptografická opatření'
                ];

                requirements.forEach((req, index) => {
                    const status = nis2Checkboxes[index] &&
                                  document.getElementById(nis2Checkboxes[index]) &&
                                  document.getElementById(nis2Checkboxes[index]).checked ? '✅' : '❌';
                    doc.text(`${status} ${req.substring(2)}`, 30, 150 + (index * 10));
                });

                doc.text('Doporučení:', 20, 220);
                if (compliance >= 83) {
                    doc.text('✅ Vysoká úroveň souladu - pravidelný audit doporučen', 30, 235);
                } else if (compliance >= 67) {
                    doc.text('⚠️ Střední úroveň - doplnit chybějící opatření', 30, 235);
                } else {
                    doc.text('❌ Kritická úroveň - okamžitá implementace požadovaných opatření', 30, 235);
                }

                // Footer
                doc.setFontSize(8);
                doc.text(`Vygenerováno: ${new Date().toLocaleString('cs-CZ')}`, 20, 280);
                doc.text('Na základě NIS2 směrnice (EU/2022/2555)', 20, 285);

                doc.save('nis2_compliance_report_czech.pdf');
                alert('✅ PDF NIS2 compliance report byl vygenerován a stažen!');
            } catch (error) {
                console.error('PDF Error:', error);
                alert('❌ Chyba při generování PDF: ' + error.message);
            }
        }
    </script>
</body>
</html>
